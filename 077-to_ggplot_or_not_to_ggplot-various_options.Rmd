
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(flair)
library(knitr)
```

# Various useful options

*Written by Yena Joo and last updated on 7 October 2021.*

## Introduction
We learned how to create plots so far, now we are going to learn how to apply some additional functions to the graph to give them some changes. Visualization plays a very important role when using data analysis results. 

In this lesson, you will learn how to:  

- facet plots  
- label plots  
- change colors of the plots  
- function `breaks_pretty()`  

Prerequisite skills include:  

- You should be familiar with `ggplot` now.  
- You also should be able to read and manipulate datasets.  

Highlights:  

- Everything about how to make plots prettier!!

### Packages  
```{r, message = F}
library(ggplot2)
library(scales)
```


## Faceting
Faceting allows you to construct multi-panel plots and monitor how the scales of one panel compare to the scales of another. Which means, it partitions a plot into multiple panels. Each panel shows a different subset of the data.  

In other words, it is sometimes necessary to create a graph for each group in data by splitting one plot into multiple plots. In this case, you can use the `facet_wrap()` and `facet_grid()` functions. These functions have the advantage of noticing the distribution of data by group easily.  

There are two main functions for faceting :  

- `facet_grid()`: produces a 2d grid of panels defined by variables which form the rows and columns.  
- `facet_wrap()`:  "wraps" a 1d ribbon of panels into 2d.  

### `facet_grid()`
facet_grid(x ~ y) will display x*y plots even if some plots are empty. This function defines the shape feature of the panel. When used with ggplot, the x-axis and y-axis are kept as they are, and displayed divided by the variables you specify inside the argument. For example, `facet_grid(. ~ Variable)` changes the plot vertically.  

#### Arguments 
```
facet_grid( rows = NULL, cols = NULL, scales = "fixed", space = "fixed", shrink = TRUE, labeller = "label_value", as.table = TRUE, switch = NULL, drop = TRUE, margins = FALSE, facets = NULL)
```  

- rows, cols: A set of variables quoted by `vars()`. It can also be displayed `(variable ~ variable)`.
- scales: scales shared across all facets. (`"fixed"`, `"free_x"`, `"free_y"`, `"free"`).  

For more information, click [here](https://ggplot2.tidyverse.org/reference/facet_grid.html).   

**Facet with one variable**  

Here, I am using a dataset that contains the information of members who climbed the mountain Himalaya. Let's say, I would like to see the distribution of the sex of the members.   
```{r  message = F, warning = F}
members <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/members.csv')
hist_p <- members %>% ggplot(aes(age)) + geom_histogram(fill = "light blue", bins = 10)

# Split in vertical direction
hist_p + facet_grid(sex ~ .)
# Split in horizontal direction
hist_p + facet_grid(. ~ sex)
```
  
Splitting in vertical direction can be done with putting whichever variable you want to facet on the left, `facet_grid(variable ~ .)`. Putting the variable on the right side would split horizontally.  


**Facet with two variables**   
You can also facet with two variables. Here, I will facet with variables `success` and `injured`. Since they are both type boolean, it would be better to label the categories using `labeller = label_both`. 
```{r, message = F, warning = F}
hist_p + facet_grid(success ~ injured, labeller=label_both)
```
 
 

### `facet_wrap()`
`facet_wrap()` wraps a 1d sequence of panels into 2d. It is easy to understand by comparing the distribution of data by group(category).  

This function partitions the plot based on a categorical variable, and according to the factor of this column, the plot for each group is divided into subplots.  

#### Arguments
```
facet_wrap(facets, nrow = NULL, ncol = NULL, scales = "fixed", shrink = TRUE, labeller = "label_value", as.table = TRUE, switch = NULL, drop = TRUE, dir = "h", strip.position = "top") 
```   

- facets: set of variables. defines faceting groups on the rows or columns dimension.  
- nrow, ncol: Number of rows and columns.  
- scales: Specifies whether the x-axis and y-axis of each subplot are fixed.  
Note that the column, which is passed to this function, must be a factor, discrete variable.  

Here is an [additional information on the arguments and examples](https://ggplot2.tidyverse.org/reference/facet_wrap.html) you may find helpful.   

Facets can be placed side by side using the function facet_wrap() as follows:  
```{r message = F, warning = F}
hist_p + facet_wrap(~ sex, nrow = 3, ncol=3)
```
  
`facet_wrap(x ~ y)`displays only the plots having actual values. The function displays plots for every combination of the selected variables.  

However, so far we don't see much of a difference between `facet_grid()` and `facet_wrap()`, since the selected data is simple. Let's try to use a rather complex plot to see the difference between the two functions.  

### `facet_grid()` vs `facet_wrap()`

We will use a built-in dataset `mpg`. First, create a scatter plot with variables `hwy` and `displ`. Then, I will use the variable `manufacturer` to facet the plot, using both `facet_grid()` and `facet_wrap()`.  

```{r}
p <- ggplot(data = mpg, aes(hwy, displ)) + geom_point()
p + facet_wrap(vars(manufacturer))
p + facet_grid(vars(manufacturer))
```
  
Now you can clearly see the difference between the two functions with the default arguments.   

## Labelling ggplot

ggplots can be labeled using `labs()`as follow:
```{r}
japanese_blooming <- read.csv("https://raw.githubusercontent.com/tacookson/data/master/sakura-flowering/temperatures-modern.csv")
japanese_blooming %>% 
  ggplot(aes(mean_temp_c)) + geom_histogram(fill = "pink", bins = 20) + 
  labs(title = "This is a title",
  subtitle = "This is a subtitle",
  caption = "This is a caption",
  tag = "This is a tag", 
  x = "This is a x-axis label",
  y= "This is an y-axis label")
```
 
### Arguments for `labs()`

- title: The text for the title.  
- subtitle: The text for the subtitle for the plot which will be displayed below the title.  
- caption: The text for the caption which will be displayed in the bottom-right of the plot by default.  
- tag: The text for the tag label which will be displayed at the top-left of the plot by default.  
- label: The title of the respective axis (for xlab() or ylab()) or of the plot (for ggtitle()).  
- x: x-axis label  
- y: y-axis label  

### Labeling without using `labs()`  

- `xlab()` and `ylab()` adds the x-axis and y-axis labels.  
- `ggtitle("title", subtitle = "subtitle")` adds a title and a subtitle.

```{r}
japanese_blooming %>% 
  ggplot(aes(mean_temp_c)) + geom_histogram(fill = "pink", bins = 20) + 
  xlab("another way to add x-axis label") + 
  ylab("another way to add y-axis label") + 
  ggtitle("Another way to add a title", subtitle = "Another way to add a subtitle")
```



## How to change colors of ggplot

### Change to a single color
For plots such as boxplots and histogram, you can choose what color you want to "fill" and what color you want as an outline of the graph. When making ggplots, you just add `geom_PLOTTYPE(fill = "color", color = "color")`.
```{r}
# box plot
ggplot(mtcars, aes(group=vs, y=wt)) +
  geom_boxplot(fill='pink', color="red")
# scatter plot
ggplot(mtcars, aes(x=wt, y=mpg)) + 
  geom_point(color="dark red")
```

### Change color by groups
Also, you can set the color by groups of variable. It automatically sets up a legend of changing colors depending on the variable value, using `fill` or `color` `= VARIABLE NAME`. 
```{r}
# Box plot
ggplot(mtcars, aes(group = vs, y = wt, fill = vs)) +
  geom_boxplot()

# Scatter plot
ggplot(mtcars, aes(x = wt, y = mpg, color = mpg)) + geom_point()
```


### basic theme changing
`theme_gray` : gray background color and white grid lines   
`theme_bw` : white background and gray grid lines   
`theme_linedraw` : black lines around the plot  
`theme_dark()`: Dark background designed to make colours pop out  

*Note that, the function theme_set() changes the theme for the entire session.*   
(The detailed information of the basic theme changing can be found [here](http://www.sthda.com/english/wiki/ggplot2-themes-and-background-colors-the-3-elements)

## `pretty_breaks()` or `breaks_pretty()` 
`breaks_pretty()` uses default R break algorithm as implemented in pretty(). This is used often for splitting date/times. For example, when you want to divide 24 hours into 10 blocks, you would use the function `breaks_pretty` to split the time. 

```{r, eval = F}
pretty_breaks(n = 5, ...)
breaks_pretty()
```

Important argument:  

- n: desired number of breaks   
- [other arguments](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/pretty) passed on `pretty`   

Here is an example of using the function:  
  
Inside the parameter, you put the desired number of breaks. However, you may get slightly more or less breaks than what you put. 
For example, I can request to break number from 1 to 10 into 5 parts. 
```{r}
a <- breaks_pretty(n = 5)(1:10)
a
```
Then it returns 6 parts, which is slightly more than what I requested in the argument.  

Another example is to break dates into multiple parts using `as.Date()`.
```{r}
b <- pretty_breaks(n = 12)(as.Date(c("2020-01-01", "2021-01-01")))
b
```  

This would automatically return the broken down scale of the date for you.  

These are the basics of the function `breaks_pretty()` or `pretty_breaks()` (they are interchangeable). If you would like to learn more about how to use these scales in a graph and visualize them, the information could be found [here](https://bookdown.org/Maxine/ggplot2-maps/posts/2019-11-27-using-scales-package-to-modify-ggplot2-scale/)


## Exercises

### Question 1
using `facet_grid()`, divide the plot below by variable `vs`. 
```{r q1_usefuloptions, exercise=TRUE, exercise.eval = TRUE}
mtcars %>% ggplot(aes(y = mpg, x = cyl)) + geom_point()
```

```{r q1_usefuloptions-solution}
plot <- mtcars %>% ggplot(aes(y = mpg, x = cyl)) + geom_point()
plot + facet_grid(vs ~ .)
```


### Question 2
Label the following graph. Title should be 'scatter plot of mtcars', x-axis should be 'wt' and y-axis should be 'mpg'. 
```{r q2_usefuloptions, exercise=TRUE, exercise.eval = TRUE}
ggplot(mtcars, aes(x = wt, y = mpg, color = mpg)) + geom_point()
``` 

```{r q2_usefuloptions-solution}
ggplot(mtcars, aes(x = wt, y = mpg, color = mpg)) + geom_point()
```

### Question 3
Change the color of the scatter plot to 'pink'. 
```{r, q3_usefuloptions, exercise=TRUE, exercise.eval = TRUE}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point()
```
```{r, q3_usefuloptions-solution}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point(color = 'pink')
```


## Next Steps

Good visualizations can help the audience/readers remember the information or the message the plot contains. Try to make plots using useful options to make the graph readable & attractive.


## References  

- [ggplot facet](http://www.sthda.com/english/wiki/ggplot2-facet-split-a-plot-into-a-matrix-of-panels)  
- [labs()](https://www.rdocumentation.org/packages/ggplot2/versions/3.3.3/topics/labs)  
- [ggplot colours](http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually)  
- [pretty_breaks()](https://www.rdocumentation.org/packages/scales/versions/0.4.1/topics/pretty_breaks)  



## Exercises

### Question 4
Which functions are appropriate to use when you want to split one plot into multiple plots (select all that apply)?  
a. `facet_grid()`  
b. `kable()`
c. `facet_wrap()`  
d. All of the above   

### Question 5
(True or False) You can only facet with one variable.  
a. True  
b. False  

### Question 6
In the `labs()` function, which argument is going to display a label on the top-left corner of the plot by default?  
a. title  
b. caption  
c. subtitle  
d. tag  

### Question 7
(True or False) When creating a boxplot, you can choose a color to "fill" and another color to "outline" the plot.  
a. True  
b. False   

### Question 8
Which statement is correct about the function `breaks_pretty()`?   
a. It is used to split date and times.   
b. You can break a month into 50 blocks using the function.  
c. You can break 24 hours into 5 blocks using the function.  
d. All of the above.   

### Question 9
(True or False) You can use the argument `breaks = ` to set the desired number of breaks of the date/time.  
a. True  
b. False  

### Question 10
What is the purpose of using the functions introduced in the lesson?   
a. To create a simple default plot.  
b. To provide a more visually organized plots by additional visualization and labeling.  
c. To manipulate datasets.  
d. None of the above.  
