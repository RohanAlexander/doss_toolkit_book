<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 31 Grouping and ungrouping | DoSS Toolkit</title>
<meta name="author" content="Various authors">
<meta name="description" content="Written by Matthew Wankiewicz.  31.1 Introduction In this lesson, you will learn how to: Use the group_by() function in R Use the group_by() function with other functions in R. Prerequisite skills...">
<meta name="generator" content="bookdown 0.22.17 with bs4_book()">
<meta property="og:title" content="Chapter 31 Grouping and ungrouping | DoSS Toolkit">
<meta property="og:type" content="book">
<meta property="og:description" content="Written by Matthew Wankiewicz.  31.1 Introduction In this lesson, you will learn how to: Use the group_by() function in R Use the group_by() function with other functions in R. Prerequisite skills...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 31 Grouping and ungrouping | DoSS Toolkit">
<meta name="twitter:description" content="Written by Matthew Wankiewicz.  31.1 Introduction In this lesson, you will learn how to: Use the group_by() function in R Use the group_by() function with other functions in R. Prerequisite skills...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">DoSS Toolkit</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li class="book-part">Hello World!</li>
<li><a class="" href="introduction.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="getting-and-setting-up-rstudio.html"><span class="header-section-number">3</span> Getting and setting up RStudio</a></li>
<li><a class="" href="getting-to-know-what-is-what.html"><span class="header-section-number">4</span> Getting to know what is what</a></li>
<li><a class="" href="hello-world.html"><span class="header-section-number">5</span> Hello World!</a></li>
<li><a class="" href="hello-world-again.html"><span class="header-section-number">6</span> Hello World, again!</a></li>
<li><a class="" href="hello-world-again-1.html"><span class="header-section-number">7</span> Hello World, again!</a></li>
<li><a class="" href="the-r-community.html"><span class="header-section-number">8</span> The R community</a></li>
<li class="book-part">Operating in an error prone world</li>
<li><a class="" href="introduction-7.html"><span class="header-section-number">9</span> Introduction</a></li>
<li><a class="" href="getting-help-is-normal-learning-to-learn-r.html"><span class="header-section-number">10</span> Getting help is normal! – Learning to learn R</a></li>
<li><a class="" href="using-google-and-stack-overflow.html"><span class="header-section-number">11</span> Using Google and Stack Overflow</a></li>
<li><a class="" href="stack-overflow.html"><span class="header-section-number">12</span> Stack Overflow</a></li>
<li><a class="" href="when-your-code-doesnt-work.html"><span class="header-section-number">13</span> When your code doesn’t work</a></li>
<li><a class="" href="making-reproducible-examples.html"><span class="header-section-number">14</span> Making Reproducible Examples</a></li>
<li><a class="" href="how-to-make-the-most-of-rs-cryptic-error-messages.html"><span class="header-section-number">15</span> How to make the most of R’s cryptic error messages</a></li>
<li class="book-part">Holding the chaos at bay</li>
<li><a class="" href="introduction-13.html"><span class="header-section-number">16</span> Introduction</a></li>
<li><a class="" href="r-projects-and-working-directory.html"><span class="header-section-number">17</span> R Projects and working directory</a></li>
<li><a class="" href="folder-set-up.html"><span class="header-section-number">18</span> Folder set-up</a></li>
<li><a class="" href="writing-comments.html"><span class="header-section-number">19</span> Writing comments</a></li>
<li><a class="" href="installing-packages.html"><span class="header-section-number">20</span> Installing packages</a></li>
<li><a class="" href="install-from-github.html"><span class="header-section-number">21</span> Install from GitHub</a></li>
<li><a class="" href="calling-packages.html"><span class="header-section-number">22</span> Calling packages</a></li>
<li><a class="" href="updating-packages.html"><span class="header-section-number">23</span> Updating packages</a></li>
<li><a class="" href="read-csvs.html"><span class="header-section-number">24</span> Read CSVs</a></li>
<li><a class="" href="reading-tables-dta-and-other-data-types.html"><span class="header-section-number">25</span> Reading tables dta and other data types</a></li>
<li class="book-part">Hand me my plyrs</li>
<li><a class="" href="introduction-23.html"><span class="header-section-number">26</span> Introduction</a></li>
<li><a class="" href="what-is-the-tidyverse.html"><span class="header-section-number">27</span> What is the tidyverse?</a></li>
<li><a class="" href="the-pipe.html"><span class="header-section-number">28</span> The pipe</a></li>
<li><a class="" href="select.html"><span class="header-section-number">29</span> select</a></li>
<li><a class="" href="filter.html"><span class="header-section-number">30</span> filter</a></li>
<li><a class="active" href="grouping-and-ungrouping.html"><span class="header-section-number">31</span> Grouping and ungrouping</a></li>
<li><a class="" href="summarise.html"><span class="header-section-number">32</span> summarise</a></li>
<li><a class="" href="arrange.html"><span class="header-section-number">33</span> arrange</a></li>
<li><a class="" href="mutate.html"><span class="header-section-number">34</span> mutate</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">35</span> pivoting</a></li>
<li><a class="" href="rename.html"><span class="header-section-number">36</span> rename</a></li>
<li><a class="" href="counting.html"><span class="header-section-number">37</span> counting</a></li>
<li><a class="" href="slice.html"><span class="header-section-number">38</span> slice</a></li>
<li><a class="" href="data-2.html"><span class="header-section-number">39</span> data</a></li>
<li><a class="" href="length-rows-columns-and-dimensions.html"><span class="header-section-number">40</span> length, rows, columns and dimensions</a></li>
<li class="book-part">He was a d8er boi</li>
<li><a class="" href="introduction-37.html"><span class="header-section-number">41</span> Introduction</a></li>
<li><a class="" href="head-tail-glimpse-and-summary.html"><span class="header-section-number">42</span> head, tail, glimpse and summary</a></li>
<li><a class="" href="paste-paste0-glue-and-stringr.html"><span class="header-section-number">43</span> paste, paste0, glue and stringr</a></li>
<li><a class="" href="head-tail-glimpse-and-summary-1.html"><span class="header-section-number">44</span> head, tail, glimpse and summary</a></li>
<li><a class="" href="paste-paste0-glueglue-and-stringr.html"><span class="header-section-number">45</span> paste(), paste0(), glue::glue() and stringr</a></li>
<li><a class="" href="names-rbind-and-cbind.html"><span class="header-section-number">46</span> names(), rbind() and cbind()</a></li>
<li><a class="" href="left_join-anti_join-full_join-etc.html"><span class="header-section-number">47</span> left_join(), anti_join(), full_join(), etc</a></li>
<li><a class="" href="looking-for-missing-data.html"><span class="header-section-number">48</span> Looking for missing data</a></li>
<li><a class="" href="set.seed-runif-rnorm-and-sample.html"><span class="header-section-number">49</span> set.seed(), runif(), rnorm(), and sample()</a></li>
<li><a class="" href="simulating-datasets-for-regression.html"><span class="header-section-number">50</span> Simulating datasets for regression</a></li>
<li><a class="" href="conditional-mutating-and-summarising.html"><span class="header-section-number">51</span> Conditional mutating and summarising</a></li>
<li><a class="" href="tidying-up-datasets.html"><span class="header-section-number">52</span> Tidying up datasets</a></li>
<li><a class="" href="pull-pluck-and-unnest.html"><span class="header-section-number">53</span> pull(), pluck(), and unnest()</a></li>
<li><a class="" href="forcats-and-factors.html"><span class="header-section-number">54</span> forcats and factors</a></li>
<li><a class="" href="more-on-strings.html"><span class="header-section-number">55</span> More on strings</a></li>
<li><a class="" href="regular-expressions.html"><span class="header-section-number">56</span> Regular expressions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">57</span> Working with dates</a></li>
<li><a class="" href="janitor-package.html"><span class="header-section-number">58</span> janitor package</a></li>
<li><a class="" href="tidyr-package.html"><span class="header-section-number">59</span> tidyr package</a></li>
<li><a class="" href="joins.html"><span class="header-section-number">60</span> Joins</a></li>
<li><a class="" href="looking-for-missing-data-1.html"><span class="header-section-number">61</span> Looking for missing data</a></li>
<li><a class="" href="set.seed-runif-rnorm-and-sample-1.html"><span class="header-section-number">62</span> set.seed, runif, rnorm, and sample</a></li>
<li><a class="" href="simulating-datasets-for-regression-1.html"><span class="header-section-number">63</span> Simulating datasets for regression</a></li>
<li><a class="" href="conditional-mutating-and-summarising-1.html"><span class="header-section-number">64</span> Conditional mutating and summarising</a></li>
<li><a class="" href="tidying-up-datasets-1.html"><span class="header-section-number">65</span> Tidying up datasets</a></li>
<li><a class="" href="pull-pluck-and-unnest-1.html"><span class="header-section-number">66</span> pull, pluck and unnest</a></li>
<li><a class="" href="forcats-and-factors-1.html"><span class="header-section-number">67</span> forcats and factors</a></li>
<li><a class="" href="more-on-strings-2.html"><span class="header-section-number">68</span> More on strings</a></li>
<li><a class="" href="regular-expressions-1.html"><span class="header-section-number">69</span> Regular expressions</a></li>
<li><a class="" href="working-with-dates-1.html"><span class="header-section-number">70</span> Working with dates</a></li>
<li><a class="" href="janitor.html"><span class="header-section-number">71</span> janitor</a></li>
<li><a class="" href="tidyr-package-1.html"><span class="header-section-number">72</span> tidyr package</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="grouping-and-ungrouping" class="section level1" number="31">
<h1>
<span class="header-section-number">31</span> Grouping and ungrouping<a class="anchor" aria-label="anchor" href="#grouping-and-ungrouping"><i class="fas fa-link"></i></a>
</h1>
<p>Written by Matthew Wankiewicz.</p>
<div id="introduction-27" class="section level2" number="31.1">
<h2>
<span class="header-section-number">31.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-27"><i class="fas fa-link"></i></a>
</h2>
<p>In this lesson, you will learn how to:</p>
<ul>
<li>Use the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function in R</li>
<li>Use the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function with other functions in R.</li>
</ul>
<p>Prerequisite skills include:</p>
<ul>
<li>Having R installed on your computer/Having RStudio Cloud.</li>
<li>Having <code>tidyverse</code> installed on R.</li>
</ul>
<p>Highlights:</p>
<ul>
<li>The <code>group_by</code> function allows you to group datasets by variables you choose.</li>
<li>
<code>group_by</code> works best when paired with other dplyr functions, either counting the number of items in a group or making new variables from groups.</li>
</ul>
<div class="figure">
<img src="https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/group_by_ungroup.png" width="400" height="300" alt=""><p class="caption">Image Source:<a href="https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/group_by_ungroup.png" class="uri">https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/group_by_ungroup.png</a>, Allison Horst</p>
</div>
</div>
<div id="the-content" class="section level2" number="31.2">
<h2>
<span class="header-section-number">31.2</span> The content<a class="anchor" aria-label="anchor" href="#the-content"><i class="fas fa-link"></i></a>
</h2>
<p>A major part of data analysis is seeing how your data looks using particular groups and the <code>group_by</code> function is very helpful with this. The <code>group_by</code> function takes a data frame and allows you to use other functions to get an idea of what these groups look like.</p>
<p>The <code>group_by</code> function is useful for conducting operations on your dataset when you want to break up the points by group. For example, if you have a data frame with the heights and weights of different animals, the <code>group_by</code> function is useful for finding things like the mean weight of each type of animal in the data frame. The function <code>ungroup</code> is used to remove the grouping done by the <code>group_by</code> function.</p>
<p>Normally, the <code>group_by</code> function is paired with other dplyr functions in order to conduct your analysis.</p>
<p>The <code>ungroup</code> function takes one argument, a grouped data frame that you want to ungroup. This is useful for ungrouping your data after you have run your analysis and want to work with the whole data frame again.</p>
<p>Brief Overview of the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> functions:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/011h7uREXAU" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="arguments-2" class="section level2" number="31.3">
<h2>
<span class="header-section-number">31.3</span> Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p><strong><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code></strong>: The two main arguments for <code>group_by</code> are the data you plan to analyze and variables you want to group. When you enter in the data you plan to analyze, it will be the first argument. You can either write the name of the dataset as the first argument or pipe it into the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function. Once you have your dataset in the function, you then have to write in the variable names you plan to group. You can write as many variables as you want when using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>.</p></li>
<li><p><strong><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code></strong>: The <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> function takes one argument, the grouped data that you want to ungroup. This is useful for ungrouping your data after you have run your analysis and want to work with the whole data frame again.</p></li>
</ul>
</div>
<div id="other-optional-arguments" class="section level2" number="31.4">
<h2>
<span class="header-section-number">31.4</span> Other Optional Arguments<a class="anchor" aria-label="anchor" href="#other-optional-arguments"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<strong><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code></strong>: The two optional arguments are .add and .drop. .add determines whether or not the function makes new groups in the data. .drop drops groups that were formed before-hand which we may not see in the data.</li>
</ul>
</div>
<div id="questions-1" class="section level2" number="31.5">
<h2>
<span class="header-section-number">31.5</span> Questions<a class="anchor" aria-label="anchor" href="#questions-1"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_grouped</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">penguins_grouped</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 8</span>
<span class="co">#&gt; # Groups:   species [1]</span>
<span class="co">#&gt;   species island    bill_length_mm bill_depth_mm</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Adelie  Torgersen           39.1          18.7</span>
<span class="co">#&gt; 2 Adelie  Torgersen           39.5          17.4</span>
<span class="co">#&gt; 3 Adelie  Torgersen           40.3          18  </span>
<span class="co">#&gt; 4 Adelie  Torgersen           NA            NA  </span>
<span class="co">#&gt; 5 Adelie  Torgersen           36.7          19.3</span>
<span class="co">#&gt; 6 Adelie  Torgersen           39.3          20.6</span>
<span class="co">#&gt; # … with 4 more variables: flipper_length_mm &lt;int&gt;,</span>
<span class="co">#&gt; #   body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt;</span></code></pre></div>
<p>As you can see above, using the <code>group_by</code> function does not appear to do anything when it is done on its own. When you have a grouped data frame, you usually pair it with another function to get the data you want.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;       n</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1   344</span></code></pre></div>
<p>The chunk above takes the penguins data frame and counts how many observations are included. The output is only one number which represent all of the penguins. In the chunk below, we will use the <code>group_by</code> function to see the number of penguins of each species present in the data frame.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 × 2</span>
<span class="co">#&gt; # Groups:   species [3]</span>
<span class="co">#&gt;   species       n</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1 Adelie      152</span>
<span class="co">#&gt; 2 Chinstrap    68</span>
<span class="co">#&gt; 3 Gentoo      124</span></code></pre></div>
<p>In the chunk above, I used the grouped data frame that was created in the chunk before and ran it with the <code>count</code> function. This allows us to see how many penguins of each species are present in the data frame.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># use na.rm to remove missing values</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>average_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 × 2</span>
<span class="co">#&gt;   species   average_weight</span>
<span class="co">#&gt;   &lt;fct&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Adelie             3701.</span>
<span class="co">#&gt; 2 Chinstrap          3733.</span>
<span class="co">#&gt; 3 Gentoo             5076.</span></code></pre></div>
<p>This chunk shows how we can use the <code>group_by</code> function with the <code>summarise</code> function to get summary statistics for each species. To do this, you can either take the grouped data frame and pipe it into the <code>summarise</code> function or you can use the <code>group_by</code> function on the initial data frame and then pipe that into the <code>summarise</code> function.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>average_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
            average_flipper_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 × 3</span>
<span class="co">#&gt;   species   average_weight average_flipper_length</span>
<span class="co">#&gt;   &lt;fct&gt;              &lt;dbl&gt;                  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Adelie             3701.                   190.</span>
<span class="co">#&gt; 2 Chinstrap          3733.                   196.</span>
<span class="co">#&gt; 3 Gentoo             5076.                   217.</span></code></pre></div>
<p>This is an example of using the <code>group_by</code> function and the <code>summarise</code> function after piping in your initial data frame. As you can see, there is another column present in the output, compared to the chart above. This was done by adding in another argument to the <code>summarise</code> function which now gives us the average flipper length of each species of penguin.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>average_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'species'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 8 × 3</span>
<span class="co">#&gt; # Groups:   species [3]</span>
<span class="co">#&gt;   species   sex    average_weight</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Adelie    female          3369.</span>
<span class="co">#&gt; 2 Adelie    male            4043.</span>
<span class="co">#&gt; 3 Adelie    &lt;NA&gt;            3540 </span>
<span class="co">#&gt; 4 Chinstrap female          3527.</span>
<span class="co">#&gt; 5 Chinstrap male            3939.</span>
<span class="co">#&gt; 6 Gentoo    female          4680.</span>
<span class="co">#&gt; 7 Gentoo    male            5485.</span>
<span class="co">#&gt; 8 Gentoo    &lt;NA&gt;            4588.</span></code></pre></div>
<p>The <code>group_by</code> function can also be used with multiple variables. This is an example of using two variables to group our data, this time we will use species and sex. Once again, we can see that visually, the data doesn’t look different but when we apply other functions to it, the data will appear differently.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>average_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'species', 'sex'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 22 × 4</span>
<span class="co">#&gt; # Groups:   species, sex [8]</span>
<span class="co">#&gt;    species   sex     year average_weight</span>
<span class="co">#&gt;    &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Adelie    female  2007          3390.</span>
<span class="co">#&gt;  2 Adelie    female  2008          3386 </span>
<span class="co">#&gt;  3 Adelie    female  2009          3335.</span>
<span class="co">#&gt;  4 Adelie    male    2007          4039.</span>
<span class="co">#&gt;  5 Adelie    male    2008          4098 </span>
<span class="co">#&gt;  6 Adelie    male    2009          3995.</span>
<span class="co">#&gt;  7 Adelie    &lt;NA&gt;    2007          3540 </span>
<span class="co">#&gt;  8 Chinstrap female  2007          3569.</span>
<span class="co">#&gt;  9 Chinstrap female  2008          3472.</span>
<span class="co">#&gt; 10 Chinstrap female  2009          3523.</span>
<span class="co">#&gt; # … with 12 more rows</span></code></pre></div>
<p>This output shows us the average weights of the penguins, when grouped by species and sex. We can see that there are levels for each of the three species (Adelie, Chinstrap and Gentoo) and the three gender levels present (Male, Female and NA).</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 × 8</span>
<span class="co">#&gt; # Groups:   species, sex [6]</span>
<span class="co">#&gt;   species   island bill_length_mm bill_depth_mm</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Adelie    Biscoe           43.2          19  </span>
<span class="co">#&gt; 2 Adelie    Biscoe           39.6          20.7</span>
<span class="co">#&gt; 3 Gentoo    Biscoe           49.2          15.2</span>
<span class="co">#&gt; 4 Gentoo    Biscoe           46.5          14.8</span>
<span class="co">#&gt; 5 Gentoo    Biscoe           45.2          14.8</span>
<span class="co">#&gt; 6 Chinstrap Dream            46            18.9</span>
<span class="co">#&gt; 7 Chinstrap Dream            52            20.7</span>
<span class="co">#&gt; # … with 4 more variables: flipper_length_mm &lt;int&gt;,</span>
<span class="co">#&gt; #   body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt;</span></code></pre></div>
<p>The <code>group_by</code> function also works with the <code>filter</code> function. The chunk above gives us the penguins with the largest body mass for each of the groups we created.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 × 2</span>
<span class="co">#&gt; # Groups:   species [3]</span>
<span class="co">#&gt;   species       n</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1 Adelie      152</span>
<span class="co">#&gt; 2 Chinstrap    68</span>
<span class="co">#&gt; 3 Gentoo      124</span>

<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;       n</span>
<span class="co">#&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1   344</span></code></pre></div>
<p>This chunk demonstrates the <code>ungroup</code> function. The output of the first code is the same as one of the previous examples, it gives us the number of penguins present for each species.</p>
<p>The second group of code shows us what <code>ungroup</code> does. The <code>ungroup</code> function was placed just before the <code>count</code> function so instead of giving us the number of penguins in each species, we get the number of penguins in the whole data frame.</p>
<p><strong>Brief Overview of the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> functions</strong>:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/011h7uREXAU" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="exercises-13" class="section level2" number="31.6">
<h2>
<span class="header-section-number">31.6</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-13"><i class="fas fa-link"></i></a>
</h2>
<p><strong>1.</strong> Use the group_by function to count how many penguins were studied each year and also group them by their sex. Remember the data frame is called “penguins” and the year variable is called “year,” sex is called “sex.”</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## FINAL SOLUTION ## </span>
<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 9 × 3</span>
<span class="co">#&gt; # Groups:   year, sex [9]</span>
<span class="co">#&gt;    year sex        n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1  2007 female    51</span>
<span class="co">#&gt; 2  2007 male      52</span>
<span class="co">#&gt; 3  2007 &lt;NA&gt;       7</span>
<span class="co">#&gt; 4  2008 female    56</span>
<span class="co">#&gt; 5  2008 male      57</span>
<span class="co">#&gt; 6  2008 &lt;NA&gt;       1</span>
<span class="co">#&gt; 7  2009 female    58</span>
<span class="co">#&gt; 8  2009 male      59</span>
<span class="co">#&gt; 9  2009 &lt;NA&gt;       3</span>

<span class="co">## OR ##</span>

<span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 9 × 3</span>
<span class="co">#&gt; # Groups:   year [3]</span>
<span class="co">#&gt;    year sex        n</span>
<span class="co">#&gt;   &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1  2007 female    51</span>
<span class="co">#&gt; 2  2007 male      52</span>
<span class="co">#&gt; 3  2007 &lt;NA&gt;       7</span>
<span class="co">#&gt; 4  2008 female    56</span>
<span class="co">#&gt; 5  2008 male      57</span>
<span class="co">#&gt; 6  2008 &lt;NA&gt;       1</span>
<span class="co">#&gt; 7  2009 female    58</span>
<span class="co">#&gt; 8  2009 male      59</span>
<span class="co">#&gt; 9  2009 &lt;NA&gt;       3</span></code></pre></div>
<p><strong>2.</strong> Using the penguins data frame, group by both <code>island</code>, <code>sex</code> and <code>species</code> and give the average bill length (<code>bill_length_mm</code>), average bill depth (<code>bill_depth_mm</code>) and the difference between average bill length and average bill depths.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">island</span>, <span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
            avg_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,
            diff_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'island', 'sex'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 13 × 6</span>
<span class="co">#&gt; # Groups:   island, sex [9]</span>
<span class="co">#&gt;    island    sex    species   avg_length avg_depth diff_depth</span>
<span class="co">#&gt;    &lt;fct&gt;     &lt;fct&gt;  &lt;fct&gt;          &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Biscoe    female Adelie          37.4      17.7       19.7</span>
<span class="co">#&gt;  2 Biscoe    female Gentoo          45.6      14.2       31.3</span>
<span class="co">#&gt;  3 Biscoe    male   Adelie          40.6      19.0       21.6</span>
<span class="co">#&gt;  4 Biscoe    male   Gentoo          49.5      15.7       33.8</span>
<span class="co">#&gt;  5 Biscoe    &lt;NA&gt;   Gentoo          45.6      14.6       NA  </span>
<span class="co">#&gt;  6 Dream     female Adelie          36.9      17.6       19.3</span>
<span class="co">#&gt;  7 Dream     female Chinstrap       46.6      17.6       29.0</span>
<span class="co">#&gt;  8 Dream     male   Adelie          40.1      18.8       21.2</span>
<span class="co">#&gt;  9 Dream     male   Chinstrap       51.1      19.3       31.8</span>
<span class="co">#&gt; 10 Dream     &lt;NA&gt;   Adelie          37.5      18.9       18.6</span>
<span class="co">#&gt; 11 Torgersen female Adelie          37.6      17.6       20.0</span>
<span class="co">#&gt; 12 Torgersen male   Adelie          40.6      19.4       21.2</span>
<span class="co">#&gt; 13 Torgersen &lt;NA&gt;   Adelie          37.9      18.2       NA</span>
<span class="co"># na.rm = T is optional, safer to use it if you're unsure if </span>
<span class="co"># your data contains NA's</span></code></pre></div>
<p>Solution to Exercise 1:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pTuGhkNCTnc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Solution to Exercise 2:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Dr4b18O-aGo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="common-mistakes-errors-8" class="section level2" number="31.7">
<h2>
<span class="header-section-number">31.7</span> Common Mistakes &amp; Errors<a class="anchor" aria-label="anchor" href="#common-mistakes-errors-8"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, you will encounter some errors in the <code>group_by</code> function. In this section, we’ll cover what you should do when some of the common errors occur.</p>
<ol style="list-style-type: decimal">
<li>Error: Must group by variables found in <code>.data</code>
</li>
</ol>
<p>When this occurs, you are probably trying to group your data frame by a variable that isn’t in the data frame. Often times, this happens because of a typo in the variable you want to select.</p>
<ol start="2" style="list-style-type: decimal">
<li>Error in eval(lhs, parent, parent) : object ‘totally_real_data_frame’ not found</li>
</ol>
<p>When this error occurs, R is telling us that the data frame we are trying to make groups from does not exist. Once again, this is usually because of a typo.</p>
<ol start="3" style="list-style-type: decimal">
<li>Error in group_by(data) : could not find function “group_by”</li>
</ol>
<p>When this occurs, it means that R can’t find the <code>group_by</code> function. To fix this, you should try to load the <code>tidyverse</code> library in.</p>
<p>Some mistakes that you may run into when using <code>group_by</code> and <code>ungroup</code>:</p>
<ul>
<li><p>Calling for variables that are not in the data frame you plan to analyze (usually typos).</p></li>
<li><p>Not calling in the tidyverse/dplyr library in R.</p></li>
<li><p>Sometimes you can encounter difficulties with other functions, usually, typos will be the biggest issue.</p></li>
</ul>
</div>
<div id="next-steps-15" class="section level2" number="31.8">
<h2>
<span class="header-section-number">31.8</span> Next Steps<a class="anchor" aria-label="anchor" href="#next-steps-15"><i class="fas fa-link"></i></a>
</h2>
<p>Now that you have got some experience with the <code>group_by</code> and <code>ungroup</code> functions, these links are useful resources to expand your understanding.</p>
<ul>
<li><p>R for Data Science contains the <code>group_by</code> function with other dplyr functions: <a href="https://r4ds.had.co.nz/transform.html" class="uri">https://r4ds.had.co.nz/transform.html</a></p></li>
<li><p>Section 6.11 of OHI Data Science Training looks at the <code>group_by</code> function: <a href="https://ohi-science.org/data-science-training/dplyr.html#group_by-operates-on-groups" class="uri">https://ohi-science.org/data-science-training/dplyr.html#group_by-operates-on-groups</a>)</p></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="filter.html"><span class="header-section-number">30</span> filter</a></div>
<div class="next"><a href="summarise.html"><span class="header-section-number">32</span> summarise</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#grouping-and-ungrouping"><span class="header-section-number">31</span> Grouping and ungrouping</a></li>
<li><a class="nav-link" href="#introduction-27"><span class="header-section-number">31.1</span> Introduction</a></li>
<li><a class="nav-link" href="#the-content"><span class="header-section-number">31.2</span> The content</a></li>
<li><a class="nav-link" href="#arguments-2"><span class="header-section-number">31.3</span> Arguments</a></li>
<li><a class="nav-link" href="#other-optional-arguments"><span class="header-section-number">31.4</span> Other Optional Arguments</a></li>
<li><a class="nav-link" href="#questions-1"><span class="header-section-number">31.5</span> Questions</a></li>
<li><a class="nav-link" href="#exercises-13"><span class="header-section-number">31.6</span> Exercises</a></li>
<li><a class="nav-link" href="#common-mistakes-errors-8"><span class="header-section-number">31.7</span> Common Mistakes &amp; Errors</a></li>
<li><a class="nav-link" href="#next-steps-15"><span class="header-section-number">31.8</span> Next Steps</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/035-hand_me_my_plyrs-group_by.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/035-hand_me_my_plyrs-group_by.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>DoSS Toolkit</strong>" was written by Various authors. It was last built on 2021-09-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
